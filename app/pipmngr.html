<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width">
	<title>Package Manager</title>
	<style>
		table, tr{
			border: 1px solid;
			border-collapse: collapse;
		}

		td{
			padding-top: 6px;
			padding-bottom: 6px;
			border: 1px solid;
		}

		tr:first-child{
			font-weight: bold;
		}

		tr:nth-child(2n+2){
			background-color: antiquewhite;
		}

		tr:nth-child(2n+1){
			background-color: blanchedalmond;
		}

		#erroutput{
			background-color: rgb(180, 76, 76);
		}
	</style>
</head>


<body>
<h1>Python Package Manager</h1>

<p><a href="index.html">Main Screen</a></p>


<button id="btnInstalled">Installed Modules</button>


<div id="modules"></div>
<div id="pipoutput"></div>



<script>
	"use strict"
	const btnInstalled = document.querySelector('#btnInstalled');
	btnInstalled.onclick = (evt) => 
	{
		btnInstalled.disabled = true;
		const divModules = document.querySelector('#modules');
		divModules.innerHTML="";

		let cmd = "py -"+localStorage.getItem("pyversion") + " -m pip list --format=json "

		window.api.runcmd(cmd)
		.then(output => 
		{
			let table = divModules.appendChild(document.createElement("table"));
			let header = table.appendChild(document.createElement("thead"));
			let row = header.appendChild(document.createElement("tr"));
			let col1 = row.appendChild(document.createElement("td"));
			col1.innerHTML="Name";
			let col2 = row.appendChild(document.createElement("td"));
			col2.innerHTML="Version";
			let col3 = row.appendChild(document.createElement("td"));
			
			let jsonData = JSON.parse(output);

			for (let i = 0; i <jsonData.length; i++) 
			{
				let e = jsonData[i];

				row = header.appendChild(document.createElement("tr"));
				col1 = row.appendChild(document.createElement("td"));
				col1.innerHTML=e.name ;
				col2 = row.appendChild(document.createElement("td"));
				col2.innerHTML=e.version;
				col3 = row.appendChild(document.createElement("td"));
				let btnInfo = col3.appendChild(document.createElement("button"));
				btnInfo.id = "info_"+e.name;
				btnInfo.innerHTML="Info";

				let btnRemove = col3.appendChild(document.createElement("button"));
				btnRemove.id = "remove_"+e.name;
				btnRemove.innerHTML="Uninstall";
				
				table.appendChild(row);

				let prg = document.querySelector("#pipoutput");

				btnInfo.onclick = (evt)=>
				{
					const AllBtns = document.getElementsByTagName("button");
					for(let b of AllBtns) b.disabled=true;

					let ShowCmd = "py -"+localStorage.getItem("pyversion") + " -m pip show " + e.name;
					window.api.runcmd(ShowCmd).
					then(output=>
					{	
						prg.scrollIntoView();
						prg.innerText=output;

						for(let b of AllBtns) b.disabled=false;
					}).
					catch(error=>
					{
						prg.scrollIntoView();
						prg.innerText=error;
					});
				}

				btnRemove.onclick = (evt)=>
				{
					const AllBtns = document.getElementsByTagName("button");
					for(let b of AllBtns) b.disabled=true;

					let remCmd = "py -"+localStorage.getItem("pyversion") + " -m pip uninstall -y " + e.name;

					window.api.runcmd(remCmd).
					then(output=>
					{	
						prg.scrollIntoView();
						prg.innerText = output;

						for(let b of AllBtns) b.disabled=false;
					}).
					catch(error=>
					{
						prg.scrollIntoView();
						prg.innerText=error;

						for(let b of AllBtns) b.disabled=false;
					});
				}

				btnInstalled.disabled = false;
			}
			
		})
		.catch(error=> console.log('Error:', error))
	}

</script>

</body>
</html>