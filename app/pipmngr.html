<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width">
	<title>Package Manager</title>
	<style>
		table, tr{
			border: 1px solid;
			border-collapse: collapse;
		}

		td{
			padding-top: 6px;
			padding-bottom: 6px;
			border: 1px solid;
		}

		tr:first-child{
			font-weight: bold;
		}

		tr:nth-child(2n+2){
			background-color: antiquewhite;
		}

		tr:nth-child(2n+1){
			background-color: blanchedalmond;
		}

		#erroutput{
			background-color: rgb(180, 76, 76);
		}
	</style>
</head>


<body>
<h1>Python Package Manager</h1>

<p><a href="index.html">Main Screen</a></p>


<button id="btnInstalledModules">Installed Modules</button>


<div id="modules"></div>
<div id="pipoutput"></div>
<div id="erroutput"></div>


<script>
	const btn = document.querySelector('#btnInstalledModules');
	btn.addEventListener("click", (evt) => 
	{
		let PyCmd = 
`
import json \n
import pkgutil \n
x = pkgutil.iter_modules() \n

lst = [] \n
for i in x: \n
	if i.ispkg: \n
		dct = {"names":i.name, "locs":str(i.module_finder)} \n
		lst.append(dct) \n


print(json.dumps(lst))
`
		window.api.runpython(PyCmd, {pythonPath: localStorage.getItem("pypath")}, true)
		.then(output => 
		{
			let s ="<table><tr><td>Name</td><td colspan=2>Location</td></tr>"
			
			let jsonData = JSON.parse(output);

			for (let i = 0; i <jsonData.length; i++) 
			{
				let e = jsonData[i];
				s += "<tr> \n";
				s += "<td>" + e.names + "</td>";
				s += "<td>" + e.locs + "</td>";
				s += "<td>" + "<button id=" + e.names +" class='pipinfo'>Info</button>" + "</td>"

				s += "</tr>";	
			}

			s += "</table>";
			let prg = document.getElementById("modules");
			prg.innerHTML=s;
			
		})
		.catch(error=> console.log('Error:', error))
	}, 
	false);

	
	function ShowInfo(event)
	{
		if(event.target.className === "pipinfo")
		{
			let errout = document.getElementById("erroutput");
			let prg = document.getElementById("pipoutput");

			let cmd = "py -"+localStorage.getItem("pyversion") + " -m pip show " + event.target.id

			window.api.runcmd(cmd).
			then(output=>
			{	
				prg.scrollIntoView();
				errout.innerText = "";
				prg.innerText=output;
			}).
			catch(error=>
			{
				errout.scrollIntoView();
				errout.innerText=error;
				prg.innerText="";
			});
		}
	}


	document.addEventListener("click", (event)=>
	{
		if(event.target === document.getElementsByTagName("button"));
			ShowInfo(event);
	});
	
</script>

</body>
</html>