<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width">
	<title>Package Manager</title>
	<style>
		table, tr{
			border: 1px solid;
			border-collapse: collapse;
		}

		td{
			padding-top: 6px;
			padding-bottom: 6px;
			border: 1px solid;
		}

		tr:first-child{
			font-weight: bold;
		}

		tr:nth-child(2n+2){
			background-color: antiquewhite;
		}

		tr:nth-child(2n+1){
			background-color: blanchedalmond;
		}

		#erroutput{
			background-color: rgb(180, 76, 76);
		}
	</style>
</head>


<body>
<h1>Python Package Manager</h1>

<p><a href="index.html">Main Screen</a></p>


<button id="btnInstalledModules">Installed Modules</button>


<div id="modules"></div>
<div id="pipoutput"></div>
<div id="erroutput"></div>



<script>
	const btnInstalled = document.querySelector('#btnInstalledModules');
	btnInstalled.onclick = (evt) => 
	{
		let cmd = "py -"+localStorage.getItem("pyversion") + " -m pip list --format=json "

		window.api.runcmd(cmd)
		.then(output => 
		{
			let table = document.body.appendChild(document.createElement("table"));
			let header = table.appendChild(document.createElement("thead"));
			let row = header.appendChild(document.createElement("tr"));
			let col1 = row.appendChild(document.createElement("td"));
			col1.innerHTML="Name";
			let col2 = row.appendChild(document.createElement("td"));
			col2.innerHTML="Version";
			let col3 = row.appendChild(document.createElement("td"));
			
			let jsonData = JSON.parse(output);

			for (let i = 0; i <jsonData.length; i++) 
			{
				let e = jsonData[i];

				row = header.appendChild(document.createElement("tr"));
				col1 = row.appendChild(document.createElement("td"));
				col1.innerHTML=e.name ;
				col2 = row.appendChild(document.createElement("td"));
				col2.innerHTML=e.version;
				col3 = row.appendChild(document.createElement("td"));
				let btn = col3.appendChild(document.createElement("button"));
				btn.id = e.name;
				btn.innerHTML="Show Info";
				
				table.appendChild(row);
			}
			
		})
		.catch(error=> console.log('Error:', error))
	}

	
	function ShowInfo(event)
	{
		if(event.target.className === "pipinfo")
		{
			let errout = document.getElementById("erroutput");
			let prg = document.getElementById("pipoutput");

			let cmd = "py -"+localStorage.getItem("pyversion") + " -m pip show " + event.target.id

			window.api.runcmd(cmd).
			then(output=>
			{	
				prg.scrollIntoView();
				errout.innerText = "";
				prg.innerText=output;
			}).
			catch(error=>
			{
				errout.scrollIntoView();
				errout.innerText=error;
				prg.innerText="";
			});
		}
	}


	document.addEventListener("click", (event)=>
	{
		if(event.target === document.getElementsByTagName("button"));
			ShowInfo(event);
	});
	
</script>

</body>
</html>