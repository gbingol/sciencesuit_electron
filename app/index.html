<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width">
	<title>ScienceSuit</title>

	<link rel="stylesheet" href="css/common.css">
	<style>
		p.FirstLetter 
		{
			font-size:1.3em;
			margin-left:10px;        
		}
		
		p.FirstLetter:first-letter 
		{
			font-size: 1.5em;         
			font-style: italic;     
			font-weight: bold;
		}

		div.PyHomes
		{
			border: 1px dashed red; 
			width: 50%;
		}

		ol.linespaced {
		padding-left: 0;
		}

		ol.linespaced li 
		{
			padding-top: 6px;
			padding-bottom: 6px;
			list-style: none;
		}

		@media only screen and (max-width:600px) 
		{
			div.PyHomes
			{
				width: 80%;
			}
		}
	</style>
</head>





<body>

<script src="mainmenu.js"></script>

<h1>ScienceSuit</h1>

<p class="FirstLetter">
	A feature-rich computing environment for engineers.</p>

<script>
	"use strict";

	function ParseListPaths(str)
	{
		/**
		@type {string[]}
		 */
		 const arr = str.split("\n");
		arr.pop(); //the last element is with empty string

		let retObj =[]
		for(let s  of arr)
		{
			s = s.trim();
			let start = s.indexOf(":");
			let end = s.indexOf(" ");
			let version = s.substring(start+1, end);

			start = s.indexOf("*");
			let IsGlobal=false;
			if(start == -1)
				start = end;
			else
			{
				start += 1;
				IsGlobal=true; //has *
			}

			let path = s.substring(start);
			path = path.trim();

			retObj.push({"version":version, "path":path, "global":IsGlobal});
		}

		return retObj;
	}

	function GenerateHTMLPythonList(output, div)
	{
		const Arr = ParseListPaths(output);

		let ol = div.appendChild(document.createElement("ol"));
		ol.className = "linespaced";

		let PyVersion = localStorage.getItem("pyversion");
		let PyPath = localStorage.getItem("pypath");

		let prevInput = null;
		
		for(let obj of Arr)
		{
			let version = obj.version, path = obj.path, IsGlobal=obj.global;

			let li = ol.appendChild(document.createElement("li"));

			let input = li.appendChild(document.createElement("input"));
			input.type="radio";
			input.name="pyhome";
			input.id=version;
			input.value = path;

			let label = li.appendChild(document.createElement("label"));
			label.htmlFor = input.id;
			label.innerHTML=path

			if(IsGlobal && PyVersion===null)
			{
				localStorage.setItem("pyversion", input.id);
				localStorage.setItem("pypath", input.value);

				input.checked=true;
				prevInput=input;
				li.style.color = "green";
			}

			if(PyVersion !== null)
			{
				input.checked = (PyVersion == input.id);
				if(input.checked)  
					prevInput=input;
				li.style.color = input.checked ? "green":"inherit";
			}

			input.onchange = function(evt)
			{
				prevInput.parentElement.style.color = "inherit";
				evt.target.parentElement.style.color = "green";

				localStorage.setItem("pyversion", evt.target.id);
				localStorage.setItem("pypath", evt.target.value);

				if(input!=prevInput)
					prevInput=input;
			}
		}
	}

	let div = document.body.appendChild(document.createElement("div"));
	div.className = "PyHomes";

	let pHeader = div.appendChild(document.createElement("p"));
	pHeader.innerHTML = "Python Management";
	pHeader.style.cssText = "text-align: center; color: red; font-weight: bold;";

	let p_PyHomes = div.appendChild(document.createElement("p"));

	
	window.api.runcmd("py --list-paths").
	then(output=> 
	{	
		GenerateHTMLPythonList(output, div);
	}).
	catch(error=>
	{
		p.innerText=error;
	});

	

</script>

</body>
</html>