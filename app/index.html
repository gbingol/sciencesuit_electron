<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width">
	<title>ScienceSuit</title>

	<link rel="stylesheet" href="css/common.css">
	<style>
		p.FirstLetter 
		{
			font-size:1.3em;
			margin-left:10px;        
		}
		
		p.FirstLetter:first-letter 
		{
			font-size: 1.5em;         
			font-style: italic;     
			font-weight: bold;
		}

		div.PyHomes
		{
			border: 1px dashed red; 
			width: 50%;
		}

		ol.linespaced {
		padding-left: 0;
		}

		ol.linespaced li 
		{
			padding-top: 6px;
			padding-bottom: 6px;
			list-style: none;
		}

		@media only screen and (max-width:600px) 
		{
			div.PyHomes
			{
				width: 80%;
			}
		}
	</style>
</head>




<div id="desktopmenu">	
	<ul class="desktopmenubar">

		<li class="singlemenu"><a class="active"  href="index.html">Home</a></li>
	
		<li class="dropdownmenu"> 
			<a class="dropbutton" href="#">Psychrometry</a>
	
			<div class="drop_menuitems">
				<a href="eng/psychrometrycalc.html">Calculator</a>
				<a href="learning/psychrometry/index.html">Simulations</a>
			</div>
		</li>

		<li class="singlemenu">
			<a href="pipmngr.html">PIP Manager</a>
		</li>
	</ul>	
</div>

	
<div id="mobilemenu" class="mobileoverlay">

	<div class="overlay-content">
		<a href="eng/psychrometrycalc.html">Psychrometry Calc</a>
		<a href="pipmngr.html">Python packages</a>
	</div>
</div>

<script src="mainmenu.js"></script>

<h1>ScienceSuit</h1>

<p class="FirstLetter">
	A feature-rich computing environment for engineers.</p>

<script>
	"use strict";

	function ParseListPaths(str)
	{
		/**
		@type {string[]}
		 */
		 const arr = str.split("\n");
		arr.pop(); //the last element is with empty string

		let retObj =[]
		for(let s  of arr)
		{
			s = s.trim();
			let start = s.indexOf(":");
			let end = s.indexOf(" ");
			let version = s.substring(start+1, end);

			start = s.indexOf("*");
			if(start == -1)
				start = end;
			else
				start += 1;

			let path = s.substring(start);
			path = path.trim();

			retObj.push({"version":version, "path":path});
		}

		return retObj;
	}

	function GenerateHTMLPythonList(output, div)
	{
		const Arr = ParseListPaths(output);

		let ol = div.appendChild(document.createElement("ol"));
		ol.className = "linespaced";

		let PyVersion = localStorage.getItem("pyversion");
		let PyPath = localStorage.getItem("pypath");

		let prevInput = null;
		
		for(let obj of Arr)
		{
			let version = obj.version, path = obj.path;

			let li = ol.appendChild(document.createElement("li"));

			let input = li.appendChild(document.createElement("input"));
			input.type="radio";
			input.name="pyhome";
			input.id=version;
			input.value = path;

			let label = li.appendChild(document.createElement("label"));
			label.htmlFor = input.id;
			label.innerHTML=path

			if(path.includes("*") && PyVersion==null)
			{
				localStorage.setItem("pyversion", input.id);
				localStorage.setItem("pypath", input.value);

				input.checked=true;
				prevInput=input;
				li.style.color = "green";
			}

			if(PyVersion != null)
			{
				input.checked = (PyVersion == input.id);
				if(input.checked)  
					prevInput=input;
				li.style.color = input.checked ? "green":"inherit";
			}

			input.onchange = function(evt)
			{
				prevInput.parentElement.style.color = "inherit";
				evt.target.parentElement.style.color = "green";

				localStorage.setItem("pyversion", evt.target.id);
				localStorage.setItem("pypath", evt.target.value);

				if(input!=prevInput)
					prevInput=input;
			}
		}
	}

	let div = document.body.appendChild(document.createElement("div"));
	div.className = "PyHomes";

	let pHeader = div.appendChild(document.createElement("p"));
	pHeader.innerHTML = "Python Management";
	pHeader.style.cssText = "text-align: center; color: red; font-weight: bold;";

	let p_PyHomes = div.appendChild(document.createElement("p"));

	
	window.api.runcmd("py --list-paths").
	then(output=> 
	{	
		GenerateHTMLPythonList(output, div);

		let p_scisuit = div.appendChild(document.createElement("p"));
		let span = p_scisuit.appendChild(document.createElement("span"));
		span.innerHTML = "Checking status of <b>scisuit</b> package...";

		window.api.runcmd("py -m pip show scisuit").
		then(ouput=> 
		{
			span.innerHTML = "<b>scisuit</b> package &#x2713;";
			
		}).
		catch(error=>
		{
			span.innerHTML = "<b>scisuit</b> is not installed: ";
			
			let anchor = p_scisuit.appendChild(document.createElement("a"));
			anchor.href="pipmngr.html";
			anchor.innerHTML = "Py Package Manager"
		});
	}).
	catch(error=>
	{
		p.innerText=error;
	});

	

</script>

</body>
</html>