<!DOCTYPE html>
<html lang="en">
	
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width">
	<title>Psychrometric Software</title>
	<style>
		table{
			margin-left: 10px;
			float: left;
		}
		td{
			padding-top: 6px;
			padding-bottom: 6px;
		}

		tr:nth-child(2n+2){
			background-color: antiquewhite;
		}

		tr:nth-child(2n+1){
			background-color: blanchedalmond;
		}

		td:nth-child(1)
		{
			font-weight: bold;
		}

		.output{
			clear: both;
			margin-top: 12px;
			padding-top: 12px;
			border-style: dashed;
			border-color: red;
			border-width: 1px;
			font-size: large;
		}

		#info{
			float: left;
			margin-left: 12px;
			padding-top: 12px;
			border-style: dashed;
			border-color: green;
			border-width: 1px;
			font-size: medium;
			display: none;
		}

	</style>
</head>

<body>

	
<h1>Psychrometric Calculator</h1>
<p>
	Usage:</p>

<ol>
	<li>Make <b>exactly</b> 3 selections,</li>
	<li>Enter corresponding numeric values,</li>
	<li>Click on compute,</li>
	<li>Results will appear at the bottom.</li>
</ol>


<table id="inputtable">
<tr>
	<td>
		<input type="checkbox" id="chkP" name="chkP">
		<label for="chkP">P: </label>
	</td>
	<td>
		<input type="text" 
			id="txtP" 
			name="txtP" 
			placeholder="Pressure (kPa)">
	</td>
</tr>
<tr>
	<td>
		<input type="checkbox" id="chkTdb" name="chkTdb">
		<label for="chkTdb">T<sub>db</sub>: </label>
	</td>
	<td>
		<input type="text" 
			id="txtTdb" 
			name="txtTdb" 
			placeholder="Dry-bulb temperature (°C)">
	</td>
</tr>

<tr>
	<td>
		<input type="checkbox" id="chkTwb" name="chkTwb">
		<label for="chkTwb">T<sub>wb</sub>: </label>
	</td>
	<td>
		<input type="text" 
			id="txtTwb" 
			name="txtTwb" 
			placeholder="Wet-bulb temperature(°C)">	
	</td>
</tr>

<tr>
	<td>
		<input type="checkbox" id="chkTdp" name="chkTdp">
		<label for="chkTdp">T<sub>dp</sub>:</label>
	</td>
	<td>
		<input type="text" 
			id="txtTdp" 
			name="txtTdp" 
			placeholder="Dew-point temperature(°C)">	
	</td>
</tr>

<tr>
	<td>
		<input type="checkbox" id="chkW" name="chkW">
		<label for="chkW">W:</label>
	</td>
	<td>
		<input type="text" 
		id="txtW" 
		name="txtW" 
		placeholder="Absolute humidity (kg/kg da)">	
	</td>
</tr>


<tr>
	<td>
		<input type="checkbox" id="chkRH" name="chkRH">
		<label for="chkRH">RH:</label>
	</td>
	<td>
		<input type="text" 
		id="txtRH" 
		name="txtRH" 
		placeholder="Relative humidity">	
	</td>
</tr>

<tr>
	<td>
		<input type="checkbox" id="chkH" name="chkH">
		<label for="chkH">H:</label>
	</td>
	<td>
		<input type="text" 
		id="txtH" name="txtH" 
		placeholder="Enthalpy (kJ / kg da)">	
	</td>
</tr>

<tr>
	<td>
		<input type="checkbox" id="chkV" name="chkV">
		<label for="chkV">V:</label>
	</td>
	<td>
		<input type="text" 
		id="txtV" name="txtV" 
		placeholder="V (m3 / kg da)">	
	</td>
</tr>

<tr>
	<td colspan="2" style="text-align: center; padding-top: 12px;">
		<button id="compute" type="button" disabled>Compute</button>
	</td>
</tr>
	
</table>

<div id="info"></div>

<script>
	const btn = document.getElementById('compute');
	const chkP =  document.getElementById('chkP');
	const chkTdb =  document.getElementById('chkTdb');
	const chkTwb =  document.getElementById('chkTwb');
	const chkTdp =  document.getElementById('chkTdp');
	const chkW =  document.getElementById('chkW');
	const chkRH =  document.getElementById('chkRH');
	const chkH =  document.getElementById('chkH');
	const chkV =  document.getElementById('chkV');

	const txtP =  document.getElementById('txtP');
	const txtTdb =  document.getElementById('txtTdb');
	const txtTwb =  document.getElementById('txtTwb');
	const txtTdp =  document.getElementById('txtTdp');
	const txtW =  document.getElementById('txtW');
	const txtRH =  document.getElementById('txtRH');
	const txtH =  document.getElementById('txtH');
	const txtV =  document.getElementById('txtV');

	const elems = [
		["p", chkP, txtP],
		["tdb", chkTdb, txtTdb], ["twb", chkTwb, txtTwb], ["tdp", chkTdp, txtTdp],
		["w", chkW, txtW], ["rh", chkRH, txtRH],
		["h", chkH, txtH],
		["v", chkV, txtV]
	]

	let NChecked = 0;

	let table = document.getElementById("inputtable");
	table.addEventListener("click", (evt)=>
	{
		let elem = event.target;
		if(elem.type === "checkbox")
		{
			elem.checked ? NChecked++ : NChecked--;

			let infoDiv = document.querySelector("#info");
			infoDiv.style.display = NChecked != 3 ? "inline" : "none";
			infoDiv.innerHTML = `<b>${3-NChecked}</b> selections must be made`;
			btn.disabled = (NChecked!=3)

			let txt = elems.find((entry) => entry[1] == elem)[2]
			txt.required = elem.checked

			for(let i=0; i<elems.length; ++i)
			{
				let chk = elems[i][1];
				let txt = elems[i][2];

				let condition = (NChecked==3) && !chk.checked;
				txt.disabled = condition;
				chk.disabled = condition;
			}
		}
		
	});


	btn.addEventListener("click", (evt) => 
	{
		let Keys=[], Vals=[];
		for(let i=0; i<elems.length; ++i)
		{
			let lbl = elems[i][0];
			let chk = elems[i][1];
			let txt = elems[i][2];

			if(txt.required && txt.value === "")
			{
				console.log("A value must be entered for: " + lbl);
				return true;
			}
				
			if(chk.checked) 
			{
				let val = parseFloat(txt.value);

				if(isNaN(val))
				{
					console.log(txt.value + " is not a number");
					txt.value = "";
					return true;
				}

				Keys.push(lbl);
				Vals.push(lbl === "p" ? val*1000: val);
			}
		}

		let outDiv = document.body.appendChild(document.createElement("div"));
		outDiv.className = "output";
		outDiv.style.position="relative";

		let contentTxt = outDiv.appendChild(document.createElement("div"));
		let btnContainer = outDiv.appendChild(document.createElement("div"));
		btnContainer.style.position="absolute";
		btnContainer.style.right=0;
		btnContainer.style.top="0px";

		let delBtn = btnContainer.appendChild(document.createElement("button"));
		delBtn.innerHTML="Delete";
		delBtn.style.float="right";

		let copyBtn = btnContainer.appendChild(document.createElement("button"));
		copyBtn.innerHTML="Copy";
		copyBtn.style.float="right";

		delBtn.onclick = (evt) => 
		{
			document.body.removeChild(outDiv); 
			outDiv = null;
			btnContainer = null;
			delBtn = null;
			copyBtn = null;
		}

		copyBtn.onclick = (evt) => 
		{
			navigator.clipboard.writeText(contentTxt.innerText)
		}

		window.myapi.psychrometry_tojson(Keys, Vals).then(result=>
		{
			let e = JSON.parse(result);
			let s = "";
			
			s += "<b>P=</b>" + e.p + " kPa <br>";
			s += "<b>T<sub>db</sub>=</b>" + e.tdb + " &deg;C <br>";
			s += "<b>T<sub>wb</sub>=</b>" + e.twb + " &deg;C <br>";
			s += "<b>T<sub>dp</sub>=</b>" + e.tdp + " &deg;C <br>";
			s += "<b>h=</b>" + e.h + " kJ/kg da<br>";
			s += "<b>w=</b>" + e.w + " kg/kg da <br>";
			s += "<b>RH=</b>" + e.rh + " % <br>";
			s += "<b>V=</b>" + e.v + " m<sup>3</sup> / kg da <br><br>";

			s += "<i>Other properties</i> <br>"
			s += "<b>P<sub>w</sub>=</b>" + e.pw + " kPa <br>";
			s += "<b>P<sub>ws</sub>=</b>" + e.pws + " kPa";
			
			contentTxt.innerHTML = s;
			outDiv.scrollIntoView();
		});
	});
</script>
</body>
</html>
